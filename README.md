# Сервис идентификации, аутентификации и авторизации

Реализован сервис для идентификации, аутентификации и авторизации. Общий принцип работы построен на JWT-токенах.

 - API задокументировано с помощью openapi. Можно посмотреть на [swagger](https://editor.swagger.io/), вставив туда текст из файла: `./api_description.yaml`
 - Можно обратиться ко всем ручкам с помощью postman, для этого в него нужно импортировать файл с набором ручек: `./auth_api.postman_collection.json`. Для Oauth лучше стучаться через браузер, там корректно работает редирект.
 - Сервис добавлен в общий docker_compose файл и принимает запросы через nginx.

На сервисе реализованы дополнительные возможности в виде:
 - Паттерн CircuitBreaker - применяется ко всем ручкам сервиса auth
 - Rate Limit - применяется ко всем ручкам сервиса auth
 - Партицирование для таблицы истории входов пользователя.
 - Jaeger (Можно посмотреть на работу перейдя по пути http://127.0.0.1:16686/)
 - Реализована OAuth аутентификация и авторизация для vk и yandex. 

## Для запуска тестов в контейнере необходимо проделать действия, описанные ниже.
Файл настройки **docker-compose.tests.yml** располагается по пути `./docker_app/docker-compose.tests.yml`. Через него необходимо запускать тестирование приложения в контейнере.

1) Перейти в папку `./docker_app` из нее в консоли последовательно выполнить указанные команды 
2) Удаление контейнеров и томов (если уже устанавливали их ранее) - `docker-compose -f docker-compose.tests.yml down -v`
3) Запуск контейнеров с перестройкой image - `docker-compose -f docker-compose.tests.yml up -d --build`
4) После того как тесты пройдут можно зайти в логи контейнера с тестами и убедиться, что все они пройдены.

## Для запуска сервиса необходимо проделать следующие действия.
1) Перейти в папку `docker_app` в репозитории
2) Удаление контейнеров и томов (если уже устанавливали их ранее) - `docker-compose -f docker-compose.prod.yml down -v`
3) Запуск контейнеров с перестройкой image - `docker-compose -f docker-compose.prod.yml up -d --build`
4) после старта приложения в него автоматически добавляется пользователь администратора, которому доступны все действия на сервисе. авторизироваться под ним можно со следующими параметрами входа: `login/password: admin/admin`
5) Для обращения к ручкам можно воспользоваться постманом с импортированным файлом `./auth_api.postman_collection.json`
6) Для обращения к ручке OAuth лучше воспользоваться браузером.